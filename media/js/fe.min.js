var _mes=["","Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"];var base="";var base_ol="";if(document.domin=="190.66.6.168"){base="/monitor";base_ol="/monitor"}var is_portal=false;var num_carga=20;$(function(){if(typeof portal!=="undefined"){is_portal=true;base="http://monitor.colombiassh.org";base_ol="/monitor"}$("#loading").ajaxStart(function(){$("#loading").show()}).ajaxStop(function(){$("#loading").hide()});$("#lmh").click(function(){m({t:"Monitor - ColombisSSH",hid:"qlmh",w:600,h:400});return false});$(".cat").click(function(){$("div.filtro").hide();$(this).siblings("div.filtro").slideDown()});$(".btn_fcat").click(function(){setCatsHidden();addFeatures($(this).attr("class").split(" ")[0]);totalesxDepto();$(this).closest(".filtro").slideUp()});$(document).click(function(t){if(!$(t.target).closest(".cat, .filtro").length){$(".filtro").slideUp()}});var a=false;$(".tn_fcat").click(function(){$(this).closest(".filtro").find("input:checkbox").each(function(){$(this).attr("checked",a)});a=!a;return false});setCatsHidden();var h=false;$("#totalxd_all_chk").click(function(){$("#table_totalxd").find(":checkbox:not(:first)").each(function(){$(this).attr("checked",h)});h=!h});$("#filter_states").click(function(){addFeaturesFirstTime();totalesxDepto()});$("#download_incidents").click(function(){$("#loading").show();$.ajax({url:"download_incidents",success:function(){$("#loading").hide();location.href=base+"export/xls/incidentes/Monitor-Incidentes"}})});$(".close").click(function(){$(this).closest(".filtro").slideUp()});var l=2;var r=30;var q=new Date();var i=q.getFullYear();var o=q.getMonth();var s=q.getDate();var k=new Date(i,o,s,0,0).getTime();var f=new Date(k-daysToMiliseconds(r));var n=f.getDate();var g=f.getMonth();var p=f.getFullYear();var e=f.getTime();var b=new Date().getTime();$("#startDate").val(e/1000);$("#endDate").val(b/1000);markIniFin(n,g,p,s,o,i);setYear("ini",p);setYear("fin",i);$("#time").find("select").change(function(){if($(this).val()!=0){var v=getStartEnd("ini");var t=getStartEnd("fin");var w=new Date(i,o,s,0,0);var y=w.getTime();switch($(this).val()){case"a":v=new Date(i,0,1);t=new Date(i,11,31);break;case"m":v=new Date(y-daysToMiliseconds(30));t=q;break;case"s":v=new Date(y-daysToMiliseconds(7));t=q;break;case"ay":v=new Date(y-daysToMiliseconds(1));t=q;break;case"h":v=y;t=q;break}$("#startDate").val(v/1000);$("#endDate").val(t/1000);var u=v.getFullYear();var x=t.getFullYear();setYear("ini",u);setYear("fin",x);markIniFin(v.getDate(),v.getMonth(),u,t.getDate(),t.getMonth(),x);totalesxDepto();addFeaturesFirstTime()}});$("#aaaa div.v").click(function(){var t=parseInt($(this).find("div.a").text());$("#startDate").val(new Date(t,0,1,0,0,0,0).getTime()/1000);$("#endDate").val(new Date(t,11,31).getTime()/1000);addFeaturesFirstTime();setYear("ini",t);setYear("fin",t);$("#fin_text").val("31 de Diciembre");markIniFin(1,0,t,31,11,t);$("#time").hide();totalesxDepto()});var j=[[1,1]];$(".fecha").click(function(){$("div.filtro_fecha:not(#"+$(this).attr("dv")+")").hide();$("#"+$(this).attr("dv")).slideToggle()});$("div.filtro_fecha").each(function(){var t=this;$(this).find("li").click(function(){$(this).closest("div").find("li").removeClass("selected");$(this).addClass("selected");var x=$(this).attr("q");var A=$(this).attr("y");var z=$("#"+$(this).attr("q")+"_text");var v=$("#"+x+"_div");if(v.find("li.selected").length==3){var w=new Date($("li.selected[q=ini][y=yyyy]").attr("val"),$("li.selected[q=ini][y=mes]").attr("val")-1,$("li.selected[q=ini][y=dia]").attr("val")).getTime();var u=new Date($("li.selected[q=fin][y=yyyy]").attr("val"),$("li.selected[q=fin][y=mes]").attr("val")-1,$("li.selected[q=fin][y=dia]").attr("val")).getTime();if(w>u){alert("Desde debe ser menor que Hasta");z.val("");v.find("li").removeClass("selected");$("stime").val(0)}else{z.val($("li.selected[q="+x+"][y=dia]").text()+" de "+$("li.selected[q="+x+"][y=mes]").text()+" "+$("li.selected[q="+x+"][y=yyyy]").text());$("#startDate").val(w/1000);$("#endDate").val(u/1000);$("#stime").val(0)}}})});$("div.filtro_fecha").find(".close").click(function(){$("div.filtro_fecha").slideUp()});$("#lff").click(function(){var u=getStartEnd("ini");var t=getStartEnd("fin");if(u>t){alert("La fecha Desde debe ser menor que la fecha Hasta")}else{addFeaturesFirstTime();totalesxDepto()}return false});totalesxDepto();map()});m=function(a){if($("#dialog").size()){$("#dialog").dialog("destroy")}else{$("body").append('<div id="dialog"></div>')}if(a.hid){$("#dialog").html($("#"+a.hid).html())}else{if(a.html){$("#dialog").html(a.html)}else{if(a.u){$("#dialog").load(a.u,function(f,e,b){if(e=="error"&&b.status==403){window.location.href="/"}})}}}sm(a)};sm=function(a){$("#dialog").dialog({height:(a.h?a.h:500),width:(a.w?a.w:900),modal:true,title:a.t,open:a.funOpen?a.funOpen:null,close:function(){$(this).dialog("destroy");$(this).remove()}})};listReportsEvents=function(){$(".report_list_map").each(function(){$(this).hover(function(){$(this).find(".opt").show()},function(){$(this).find(".opt").hide()})});$(this).find(".t").click(function(){$(this).parent("div").find(".hide").slideToggle()})};totalesxDepto=function(j){var h=getStartEnd("ini");var a=getStartEnd("fin");var b=$("#currentCatE").val()+"|"+$("#currentCatD").val();var g;var f;_states=getStatesChecked();if(is_portal){if(typeof j==="undefined"){$(".tab_data").html("")}var e=$(".report_list_map").length;var i=["ec","dn"];if(e==0){$(".tab_data").html('<div>&nbsp;&nbsp;<img src="'+base+'/media/img/ajax-loader-mini.gif" />&nbsp;Cargando datos...</div>')}$.ajax({url:base+"/getIncidentesPortal/"+h+"/"+a+"/"+b+"/"+e+"/"+_states,dataType:"jsonp",beforeSend:function(){$("#loading").show()},success:function(r){$("#loading").hide();for(jj in r){f=r[jj]["t"];g=r[jj]["e"].length;_html="";if(g>0){if(e==0){_html+='<div class="right">Eventos en el periodo: '+f+" &nbsp;</div>"}for(var q=0,p=g;q<p;q+=1){_js=r[jj]["e"][q];_dt=_js.d.split(/\W+/);_date=[_dt[2],_mes[_dt[1]*1],_dt[0]].join(" ");_html+='<div class="clear report_list_map"> <div class="t clear">'+_js.t+'</div> <div class="hide"><div class="loc detail">'+_js.ln+' <span class="pdf opt"> <a href="http://sidih.colombiassh.org/sissh/download_pdf.php?c=2&id_depto='+_js.ld+'&id_mun=" target="_blank">Perfil '+_js.ldn+"</a></span></div> </<div></div>";_html+='<div class="clear hide"><div class="left"><b>Categorias</b></div> <div class="opt right linko"><a href="http://www.colombiassh.org/gtmi/wiki/index.php/Sistema_de_categor%C3%ADas_del_m%C3%B3dulo_de_eventos_de_conflicto" target="_blank">Definici&oacute;n</a></div>';for(c in _js.c){_html+='<div class="clear cat">&raquo;&nbsp;'+c;if(_js.c[c].length>0){_html+=": "}for(d in _js.c[c]){if(d>0){_html+=", "}_html+=_js.c[c][d]}_html+="</div>"}_html+="</div>";_html+='<div class="clear"></div> ';if(show.desc){_html+='<div class="desc hide"><b>Descripci&oacute;n</b>: '+_js.desc+"</div> "}if(show.fuente){if(_js.f!=""){_html+='<div class="f hide"><div class="ft">Fuente de noticia</div>';for(var o=0,n=_js.f.length;o<n;o+=1){_html+='<div class="fc">';if(_js.f[o][0]!=""&&_js.f[o][1]!=""){_html+='<div class="fct">'+_js.f[o][0]+" :: "+_js.f[o][1]+"</div>"}if(_js.f[o][3]!=""){_html+='<div class="fcc"><b>Descripci\u00f3n tomada de la fuente</b>: "'+_js.f[o][3]+'"</div>'}if(_js.f[o][2].indexOf("http")!=-1){_html+='<div class="fcc"><a href="'+_js.f[o][2]+'" target="_blank">'+_js.f[o][2]+"</a></div></div> "}}_html+="</div>"}}_html+="</div></div>"}if((e+num_carga)<f){_html+='<div class="btn cargar_mas">Cargar mas eventos</div>'}}else{_html+='<div class="no">No hay eventos registrados</div>'}$div=$("#incidentes_"+i[jj]);if(e==0){$div.html(_html)}else{$div.find(".cargar_mas").remove();$div.append(_html)}}$(".tab_data").find(".t").click(function(){$(this).parent("div").find(".hide").slideToggle()});$(".cargar_mas").click(function(){totalesxDepto(true);return false});listReportsEvents();if(_states!=0){selDepto($("#state").attr("centroid"))}}})}else{$("#table_totalxd tbody").html('<tr><td colspan="4"><img src="media/img/ajax-loader-mini.gif" />&nbsp;Actualizando datos...</td></tr>');$.ajax({url:base+"/totalxd/"+h+"/"+a+"/"+b+"/"+_states,dataType:"json",success:function(n){$("#table_totalxd tbody tr").remove();$("#table_totalxd").trigger("update");var l=n.t;var k;$("#table_totalxd tbody").append('<tr class="totalxd"><td></td><td class="left">Total</td><td class="ec">'+l.ec+'</td><td class="dn">'+l.dn+"</td></tr>");for(var o in n.r){_i=n.r[o];k=(_i.css=="")?"checked":"";$("#table_totalxd tbody").append('<tr class="f '+_i.css+'"><td><input type="checkbox" name="deptos[]" value="'+_i.state_id+'" '+k+' /></td><td class="n left">'+_i.d+'</td><td class="ec">'+_i.ec+'</td><td class="dn">'+_i.dn+'</td><td class="hide centroid">'+_i.c+"</td></tr>")}$("#table_totalxd").find("tr:not(:first) td.n, tr:not(:last) td.n").live("click",function(){selDepto($(this).closest("tr").find("td.centroid").html())});$("#table_totalxd").find(":checkbox").live("click",function(){if($(this).is(":checked")){$(this).closest("tr").removeClass("unselected")}else{$(this).closest("tr").addClass("unselected")}})}})}};forceSortTable=function(){var a=[[1,1]];$("#table_totalxd").trigger("update");$("#table_totalxd").trigger("sorton",[a])};setCatsHidden=function(){var a=[];$("#fcat_ec").find("input:checked").each(function(){a.push($(this).val())});$("#currentCatE").val(a);a=[];$("#fcat_dn").find("input:checked").each(function(){a.push($(this).val())});$("#currentCatD").val(a)};daysToMiliseconds=function(a){return a*24*3600*1000};getStartEnd=function(b){var a=[];a.ini=$("#startDate").val();a.fin=$("#endDate").val();return a[b]};getYear=function(a){return $("#yyyy_"+a).val()};setYear=function(b,a){$("#yyyy_"+b).val(a)};markIniFin=function(i,b,a,e,g,f){var h="selected";b=b+1;g=g+1;$("#ini_fin").find("li").removeClass("selected");$("li[y=dia][q=ini][val="+i+"]").addClass(h);$("li[y=mes][q=ini][val="+b+"]").addClass(h);$("li[y=yyyy][q=ini][val="+a+"]").addClass(h);$("li[y=dia][q=fin][val="+e+"]").addClass(h);$("li[y=mes][q=fin][val="+g+"]").addClass(h);$("li[y=yyyy][q=fin][val="+f+"]").addClass(h);$("#ini_text").val(i+" de "+_mes[b]+" "+a);$("#fin_text").val(e+" de "+_mes[g]+" "+f)};getStatesChecked=function(){var a=[];$("#table_totalxd").find(":checkbox:not(:first):checked").each(function(){if($(this).val()!=0){a.push($(this).val())}});return a.join(",")};